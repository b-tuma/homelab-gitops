{
  "ignition": {
    "version": "3.3.0"
  },
  "passwd": {
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "${pubkey}"
        ]
      }
    ]
  },
  "storage": {
    "files": [
      {
        "path": "/etc/sysctl.d/20-silence-audit.conf",
        "contents": {
          "source": "data:,kernel.printk%3D4"
        },
        "mode": 420
      },
      {
        "overwrite": true,
        "path": "/etc/motd",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/6yOUQrCMBBE/3OK+bOCNJfwCH4GRsGKglIpgghzeJlNFPqrTSHZfd2dGZJAXL8fLycBJQP6Q0feTkIP9C5JSxORrgatbjPUsjcWvSBaSCVbM4N7SFgRxQ2l8ArE+O/sLh0ixiqUYYpcMd4xnvgKY0AfhBo5Bwfx9TCsiYodxIxCbqhY9cMZAtw03nHdxir0rdQvdCy0He7X8TUc8bw8ztgN03Q4jdNtOY93AAAA//9DMJGjYwIAAA=="
        }
      },
      {
        "overwrite": true,
        "path": "/etc/hostname",
        "contents": {
          "source": "data:,${hostname}"
        },
        "mode": 420
      },
      {
        "overwrite": true,
        "path": "/etc/docker/daemon.json",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/1SO0WqEMBBF3/MVwzw3Yvso+CVFJMRbmxqNTKJoi/9esq7L7tvAOZy5f4qIscHqMKfIFX3yZJJbUdhewjJ34lZIHfeYMHbcvGXfh16fgCvinxgm/eU8+AHvrRwn4tFsOrpfZPm9LEdWRMfNjSmI6fEUCyvEm/2DX/i17exdTpEPcR3aATLBt/YbdqiTLMgvGnWo/wAAAP//9A15Td8AAAA="
        },
        "mode": 420
      },
      {
        "overwrite": true,
        "path": "/etc/systemd/system/docker.service.d/docker.conf",
        "contents": {
          "source": "data:,%5BService%5D%0AExecStart%3D%0AExecStart%3D%2Fusr%2Fbin%2Fdockerd%0A"
        },
        "mode": 420
      },
      {
        "path": "/etc/sysctl.d/K8s.conf",
        "contents": {
          "source": "data:,net.bridge.bridge-nf-call-ip6tables%20%3D%201%0Anet.bridge.bridge-nf-call-iptables%20%3D%201%0A"
        },
        "mode": 420
      },
      {
        "path": "/usr/local/bin/kubeinstall.sh",
        "contents": {
          "compression": "gzip",
          "source": "data:;base64,H4sIAAAAAAAC/7yTz44SQRDG7/MULXLQaHdpYowh8WDAAwmBhDV63PR0l0OH/jPprllwkXc30zOwMJt1T3qhSOrrqu9XVfPyBZTGQynTpkihiQoZNCmCDUranNo2Jd7JmESraHRgbqtNZLxmEGoC5U0rK1QTLeMLNtoQ1WkCUBnaNKVQwYEKnqTxGD3SLsSt8RXUtqmMTxDRokyYQIedt0FqGB+my/nt96/rm/lqeWwb8F7MrfHNnkunP37g1zJB1f2I/WbZIcnI+PTKH+P7+6KYrX4sF6svs9vZfP35mnPANr6UFn+lawfUkmHiyVQJVDScQrBPsK3n02+LC7xoFFn+KHHJKkhG8ZjvymMHqPTAedaf3HMe0QVC7qVDLq1lJ5xEIcoKRRVCZVHWJg3RepYTE4xfdVXTzeJcRVux/ZSECWdVIllaFLSn1/mYMhRkKDi01aV2b9tokXJUZI+96Y0Lmr3Zs6d1xYOF82Ki3IluOU3C2F4eehrAnO05mQgjKKdztt5WQOhqK1tR/iXQWELfGawpIf1KhE738ZQSCeOdUZh3hJqN0iTfV2n8ZHy4XMlxUj0sEpEBknqm6PC7e/6F0P91NlI7eP+O93+FCv7nPxmE0MM2RTebTq7IMvTtxTHOfdix/vlZ0wo478TFnwAAAP//FCUkw/sEAAA="
        },
        "mode": 484
      },
      {
        "path": "/usr/local/bin/kubevars.sh",
        "contents": {
          "source": "data:,CNI_VERSION%3D${cni_version}%20%26%26%20CRICTL_VERSION%3D${crictl_version}"
        },
        "mode": 484
      }
    ]
  },
  "systemd": {
    "units": [
      {
        "contents": "[Unit]\nDescription=Setup Required Packages\nAfter=network-online.target\nWants=network-online.target\nBefore=zincati.service\nConditionPathExists=!/var/lib/ostree-setup.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/bin/rpm-ostree install qemu-guest-agent conntrack\nExecStart=/bin/touch /var/lib/ostree-setup.stamp\nExecStart=/bin/systemctl --no-block reboot\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "setup-qemu-ga-conntrack.service"
      },
      {
        "contents": "[Unit]\nDescription=Setup Kubernetes\nAfter=network-online.target\nWants=network-online.target\nConditionPathExists=!/var/lib/kubernetes-setup.stamp\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/bin/bash /usr/local/bin/kubeinstall.sh\nExecStart=/bin/touch /var/lib/kubernetes-setup.stamp\nExecStart=/bin/rm -rf /usr/local/bin/kubeinstall.sh /usr/local/bin/kubevars.sh\n\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "setup-kubernetes.service"
      },
      {
        "enabled": true,
        "name": "fstrim.timer"
      },
      {
        "dropins": [
          {
            "contents": "[Service]\nExecStart=\nExecStart=/sbin/fstrim -av\n",
            "name": "override.conf"
          }
        ],
        "name": "fstrim.service"
      },
      {
        "enabled": true,
        "name": "docker.service"
      }
    ]
  }
}
